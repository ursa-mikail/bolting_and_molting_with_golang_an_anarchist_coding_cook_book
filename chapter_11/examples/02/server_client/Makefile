# Makefile

CERT_DIR=certs
SEND_FILE=file_to_send
RECEIVED_FILE=received_file

all: setup build run-server

setup:
	@echo "ğŸš§ Setting up certs and files..."
	chmod +x generate_certs.sh
	./generate_certs.sh
	echo "Hello, secure world!" > $(SEND_FILE)

build:
	@echo "ğŸ”§ Checking Go code for build..."
	#go vet ./...
	#go vet server.go client.go common.go
	#go vet server.go common.go
	#go vet client.go common.go
	go vet server.go client.go 
	@echo "âœ… Build checks passed."

run-server:
	@echo "ğŸš€ Starting the server..."
	go run server.go 

run-client:
	@echo "â³ Waiting for server to start..."
	sleep 1	
	@echo "ğŸ“¤ Running the client..."
	go run client.go 

clean:
	@echo "ğŸ§¹ Cleaning up files..."
	rm -f $(SEND_FILE) $(RECEIVED_FILE)
	rm -rf $(CERT_DIR)

reset: clean setup

help:
	@echo "ğŸ› ï¸  Available commands:"
	@echo "  make               â†’ Setup, build, and run the server"
	@echo "  make run-client    â†’ Run the client"
	@echo "  make clean         â†’ Remove all generated files"
	@echo "  make reset         â†’ Clean and regenerate everything"

